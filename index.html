<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CarGroomers | Performance Auto Studio</title>
  <meta name="description" content="Professional car detailing services including PPF, ceramic coatings, window tinting, and full detailing." />

  <!-- ‚úÖ Favicon -->
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/1995/1995470.png" type="image/png" />

  <!-- ‚úÖ Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />

  <!-- ‚úÖ Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root {
      --bg-body: #050505;
      --bg-panel: #121212;
      --bg-card: #1a1a1a;

      --primary-grad: linear-gradient(135deg, #ff0000 0%, #b30000 100%);
      --primary-solid: #ff0000;

      --accent: #ff3333;
      --text-main: #ffffff;
      --text-muted: #a3a3a3;

      --glow: 0 0 15px rgba(255, 0, 0, 0.4);
      --whatsapp-green: #25D366;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Poppins', sans-serif;
      background: var(--bg-body);
      color: var(--text-main);
      scroll-behavior: smooth;
    }

    header {
      position: fixed; top: 0; left: 0; right: 0;
      background: rgba(5, 5, 5, 0.95);
      backdrop-filter: blur(10px);
      z-index: 1000;
      border-bottom: 1px solid #333;
    }
    .nav {
      max-width: 1200px; margin: auto; padding: 14px 20px;
      display: flex; justify-content: space-between; align-items: center;
      transition: 0.3s;
    }
    .logo {
      display: flex; align-items: center; gap: 12px; font-size: 26px; font-weight: 800;
      color: #fff; text-decoration: none; text-transform: uppercase; letter-spacing: 1px;
    }

    .logo-mark {
      width: 42px; height: 42px;
      background: var(--primary-grad);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      color: #fff; font-size: 18px;
      transform: skew(-10deg);
      box-shadow: var(--glow);
      border: 2px solid #fff;
    }
    .logo span {
      background: var(--primary-grad);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .nav nav { display: flex; align-items: center; }
    .nav nav a {
      margin-left: 24px; font-weight: 500; text-decoration: none; color: #ccc;
      position: relative; padding: 5px 0; cursor: pointer; transition: 0.3s;
      font-size: 14px; text-transform: uppercase;
    }
    .nav nav a:not(.book-btn):hover { color: var(--accent); }
    .nav nav a:not(.book-btn)::after {
      content: ''; position: absolute; bottom: 0; left: 0;
      width: 0; height: 2px; background: var(--accent);
      transition: width 0.3s ease;
    }
    .nav nav a:hover::after { width: 100%; }

    .book-btn {
      padding: 12px 28px; border-radius: 50px;
      background: var(--primary-grad);
      color: #fff !important; font-weight: 700;
      box-shadow: var(--glow);
      border: 1px solid rgba(255,255,255,0.2);
      cursor: pointer; text-transform: uppercase; font-size: 13px; letter-spacing: 1px;
      position: relative; overflow: hidden;
    }
    .book-btn::before {
      content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      transition: 0.5s;
    }
    .book-btn:hover::before { left: 100%; }
    .book-btn:hover { transform: translateY(-3px); box-shadow: 0 0 25px rgba(255, 0, 0, 0.6); }

    @media (max-width: 900px) {
      .nav { flex-direction: column; gap: 15px; padding: 15px; }
      .nav nav { width: 100%; justify-content: center; flex-wrap: wrap; gap: 15px; }
      .nav nav a { margin-left: 10px; margin-right: 10px; font-size: 12px; }
    }

    .hero {
      height: 85vh; position: relative; overflow: hidden;
      display: flex; align-items: center; justify-content: center; text-align: center; color: #fff;
      margin-top: 70px;
    }
    .hero::after {
      content: ''; position: absolute; inset: 0;
      background: radial-gradient(circle, transparent 50%, #050505 100%);
      z-index: 1; pointer-events: none;
    }
    .hero-slides { position: absolute; inset: 0; z-index: -1; }
    .slide {
      position: absolute; inset: 0;
      background-size: cover; background-position: center;
      opacity: 0; transition: opacity 1.5s ease-in-out;
      filter: saturate(1.2) contrast(1.1);
    }
    .slide.active { opacity: 1; }
    .hero-overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.5); z-index: 0; }
    .hero-content { position: relative; z-index: 2; padding: 20px; }

    .hero h1 {
      font-size: clamp(34px, 6vw, 64px); margin-bottom: 20px; line-height: 1.1;
      text-transform: uppercase; font-weight: 900; letter-spacing: -1px;
      text-shadow: 0 5px 15px rgba(0,0,0,0.8);
    }
    .hero p {
      max-width: 650px; margin: 0 auto 30px; color: #e5e7eb; font-size: 18px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.8); font-weight: 300;
    }

    @media (max-width: 600px) {
      .hero { height: 78vh; }
      .hero p { font-size: 15px; padding: 0 10px; }
    }

    section { padding: 80px 20px; }
    .container { max-width: 1200px; margin: auto; }
    .section-title { text-align: center; margin-bottom: 50px; }
    .section-title h2 {
      font-size: 36px; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px;
      display: inline-block; border-bottom: 3px solid var(--primary-solid); padding-bottom: 5px;
    }
    .section-title p { color: var(--text-muted); max-width: 600px; margin: 15px auto 0; }

    .services-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; }
    .service-card {
      background: var(--bg-panel);
      border: 1px solid #222;
      border-radius: 12px; overflow: hidden; cursor: pointer; color: #fff; transition: 0.35s;
      position: relative;
    }
    .service-card:hover {
      transform: translateY(-10px);
      border-color: var(--primary-solid);
      box-shadow: var(--glow);
    }
    .media { display: grid; grid-template-columns: 1fr 1fr; gap: 2px; }
    .media img { width: 100%; height: 160px; object-fit: cover; transition: 0.5s; opacity: 0.8; }
    .service-card:hover .media img { transform: scale(1.05); opacity: 1; }
    .service-card .content { padding: 25px; }
    .service-card h3 { font-size: 20px; margin-bottom: 8px; color: #fff; text-transform: uppercase; }
    .service-card p { font-size: 14px; color: var(--text-muted); line-height: 1.5; }

    #plans { background: #0a0a0a; }
    .plans-flex-container { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; }
    .plan {
      flex: 1 1 230px; max-width: 280px;
      background: var(--bg-panel); border: 1px solid #333;
      color: #fff; border-radius: 16px; padding: 30px;
      display: flex; flex-direction: column; transition: 0.3s; cursor: pointer; position: relative;
    }
    .plan:hover { transform: translateY(-10px); border-color: var(--accent); box-shadow: var(--glow); }

    .plan h3 {
      margin-bottom: 10px; font-size: 18px; color: var(--accent);
      text-transform: uppercase; letter-spacing: 1px;
    }
    .plan .price { font-size: 32px; font-weight: 700; margin-bottom: 15px; color: #fff; }
    .plan ul { list-style: none; font-size: 14px; color: #ccc; margin-bottom: 25px; flex-grow: 1; }
    .plan li { margin-bottom: 12px; padding-left: 20px; position: relative; }
    .plan li::before { content: '‚úì'; position: absolute; left: 0; color: var(--primary-solid); font-weight: bold; }

    .plan button {
      width: 100%; padding: 12px; border: none; border-radius: 30px;
      background: #222; color: #fff; font-weight: 600; cursor: pointer; transition: 0.3s;
      border: 1px solid #333;
    }
    .plan:hover button { background: var(--primary-grad); border-color: transparent; }

    .custom-plan { border: 2px solid var(--primary-solid); background: linear-gradient(180deg, rgba(255,0,0,0.1), #050505); }

    .price-warning-box {
      margin-top: 40px;
      background: rgba(255, 193, 7, 0.1);
      border: 1px solid #ffc107;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      color: #ffc107;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }

    .gallery { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
    .gallery-item { position: relative; overflow: hidden; border-radius: 6px; height: 250px; border: 1px solid #222; }
    .gallery-item img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s; cursor: pointer; opacity: 0.85; }
    .gallery-item:hover img { transform: scale(1.05); opacity: 1; }
    .gallery-label {
      position: absolute; bottom: 0; left: 0; right: 0;
      background: var(--primary-grad); color: #fff;
      padding: 10px; font-size: 13px; text-align: center; text-transform: uppercase; font-weight: bold;
      transform: translateY(100%); transition: 0.3s;
    }
    .gallery-item:hover .gallery-label { transform: translateY(0); }

    #working { background: #050505; }
    .working-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
    }
    .working-card {
      background: var(--bg-panel);
      border: 1px solid #222;
      border-radius: 12px;
      overflow: hidden;
      transition: 0.3s;
    }
    .working-card:hover {
      transform: translateY(-6px);
      border-color: var(--primary-solid);
      box-shadow: var(--glow);
    }
    .working-card img {
      width: 100%;
      height: 220px;
      object-fit: cover;
      display: block;
      opacity: 0.9;
    }
    .working-card .w-content {
      padding: 14px 16px;
    }
    .working-card .w-content h4 {
      margin: 0 0 6px 0;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.6px;
      color: #fff;
    }
    .working-card .w-content p {
      margin: 0;
      font-size: 13px;
      color: var(--text-muted);
      line-height: 1.5;
    }

    #testimonials { background: #000; }

    .faq { max-width: 800px; margin: auto; }
    .faq-item { margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 20px; }
    .faq-item h3 { cursor: pointer; color: #fff; margin-bottom: 10px; font-weight: 600; font-size: 18px; transition: 0.3s; }
    .faq-item h3:hover { color: var(--accent); }
    .faq-item p { display: none; color: #aaa; line-height: 1.6; padding-left: 15px; border-left: 2px solid var(--primary-solid); }

    .modal {
      position: fixed; inset: 0; background: rgba(0, 0, 0, 0.95);
      display: none; align-items: center; justify-content: center; z-index: 2000; padding: 20px;
      backdrop-filter: blur(5px);
    }
    .modal-box {
      background: #111; color: #fff; border-radius: 10px; width: 100%; max-width: 500px;
      padding: 35px; position: relative; max-height: 90vh; overflow-y: auto;
      border: 1px solid #333; box-shadow: 0 0 50px rgba(200,0,0,0.1);
    }
    .close { position: absolute; top: 20px; right: 20px; font-size: 24px; cursor: pointer; color: #666; transition: 0.2s; }
    .close:hover { color: var(--primary-solid); }

    /* ‚úÖ COMBO OPTION STYLES */
    .combo-option {
      display: flex; justify-content: space-between; align-items: center;
      padding: 15px; background: #222; border-radius: 8px; margin-bottom: 10px;
      cursor: pointer; border: 1px solid #333; transition: 0.2s;
    }
    .combo-option:hover { border-color: #666; }
    .combo-option.selected { border-color: var(--primary-solid); background: #1a0505; }

    .price-summary { margin-top: 20px; padding-top: 20px; border-top: 1px solid #333; }

    label {
      display: block; margin-bottom: 8px; color: #ccc; font-size: 13px;
      text-transform: uppercase; font-weight: 600; letter-spacing: 0.5px; margin-top: 10px;
    }
    input, textarea, select {
      width: 100%; padding: 14px; border-radius: 6px;
      border: 1px solid #333; background: #000;
      color: #fff; margin-bottom: 20px; font-family: inherit; font-size: 15px;
    }
    input:focus, textarea:focus { outline: none; border-color: var(--primary-solid); box-shadow: 0 0 10px rgba(255,0,0,0.2); }

    .submit-btn {
      width: 100%; padding: 15px; background: var(--primary-grad);
      border: none; color: #fff; font-weight: bold; border-radius: 6px; cursor: pointer; text-transform: uppercase;
    }

    .whatsapp-float-btn {
      position: fixed;
      bottom: 90px;
      right: 20px;
      width: 55px; height: 55px;
      background: var(--whatsapp-green);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      z-index: 1000; transition: 0.3s;
      text-decoration: none;
    }
    .whatsapp-float-btn:hover { transform: scale(1.1); }

    .chatbot-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 55px; height: 55px;
      background: #000;
      border: 2px solid var(--primary-solid);
      border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      color: var(--primary-solid);
      font-size: 24px; cursor: pointer;
      box-shadow: 0 0 15px rgba(255,0,0,0.3);
      z-index: 1000; transition: 0.3s;
    }
    .chatbot-btn:hover { transform: scale(1.1); background: var(--primary-solid); color: #fff; }

    .chatbot-window {
      position: fixed; bottom: 160px; right: 20px;
      width: 320px; height: 450px;
      background: #111; border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.7);
      display: none; flex-direction: column;
      z-index: 1000; overflow: hidden; border: 1px solid #333;
    }

    @media (max-width: 480px) {
      .chatbot-window {
        right: 10px;
        left: 10px;
        width: auto;
        height: 70vh;
        bottom: 90px;
      }
      .whatsapp-float-btn { bottom: 155px; right: 15px; }
      .chatbot-btn { right: 15px; }
    }

    .chatbot-header {
      background: linear-gradient(90deg, #b30000, #000); color: #fff; padding: 15px;
      display: flex; justify-content: space-between; align-items: center;
    }

    .bot-identity { display: flex; align-items: center; gap: 10px; }
    .bot-avatar {
      width: 35px; height: 35px; background: #fff; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-weight: bold; color: #b30000;
    }

    .chatbot-messages {
      flex: 1; padding: 15px; overflow-y: auto;
      background: #050505; display: flex; flex-direction: column; gap: 12px;
      background-image: radial-gradient(#222 1px, transparent 1px);
      background-size: 20px 20px;
    }

    .msg { max-width: 85%; padding: 10px 14px; font-size: 13px; line-height: 1.4; word-wrap: break-word; }
    .msg.bot { align-self: flex-start; background: #222; color: #fff; border-radius: 12px 12px 12px 2px; border: 1px solid #333; }
    .msg.user { align-self: flex-end; background: var(--primary-solid); color: #fff; border-radius: 12px 12px 2px 12px; box-shadow: 0 2px 10px rgba(255,0,0,0.2); }

    .typing { font-size: 10px; color: #666; margin-left: 10px; display: none; margin-bottom: 5px; }

    .chatbot-input { display: flex; padding: 10px; border-top: 1px solid #333; background: #111; }
    .chatbot-input input {
      background: #000; color: #fff; margin-bottom: 0; border: 1px solid #333;
      flex: 1; border-radius: 20px; padding-left: 15px;
    }
    .chatbot-input button {
      margin-left: 8px; width: 40px; height: 40px;
      background: var(--primary-solid); color: #fff; border: none;
      border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;
    }

    .msg.bot a {
      color: #25D366;
      text-decoration: underline;
      font-weight: 700;
    }

    footer { background: #000; color: #777; padding: 60px 20px; border-top: 1px solid #222; }
    .footer-grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 40px; max-width: 1200px; margin: auto;
    }
    footer h3 { color: #fff; margin-bottom: 15px; text-transform: uppercase; font-size: 14px; letter-spacing: 1px; }
    footer a { color: #777; text-decoration: none; transition: 0.2s; font-size: 14px; }
    footer a:hover { color: var(--primary-solid); }
    .footer-info p { margin-bottom: 10px; font-size: 14px; }

    .back-to-top {
      position: fixed; bottom: 20px; left: 20px;
      width: 40px; height: 40px;
      background: #333; color: #fff;
      border-radius: 4px; display: flex; align-items: center; justify-content: center;
      cursor: pointer; opacity: 0; transition: 0.3s;
      z-index: 1000; pointer-events: none; border: 1px solid #444;
    }
    .back-to-top:hover { background: var(--primary-solid); border-color: var(--primary-solid); }
    .back-to-top.show { opacity: 1; pointer-events: auto; }

    .status-popup {
      position: fixed;
      top: 90px;
      right: 20px;
      width: 320px;
      background: #111;
      border: 1px solid #333;
      box-shadow: 0 10px 30px rgba(0,0,0,0.7);
      border-radius: 12px;
      padding: 16px;
      z-index: 3000;
      display: none;
    }
    .status-popup h4 {
      margin: 0 0 10px;
      font-size: 14px;
      text-transform: uppercase;
      color: var(--primary-solid);
      letter-spacing: 1px;
    }
    .status-popup p {
      margin: 0;
      color: #ddd;
      font-size: 13px;
      line-height: 1.4;
    }
    .status-popup .close-popup {
      position: absolute;
      top: 10px;
      right: 12px;
      cursor: pointer;
      color: #aaa;
      font-size: 18px;
    }
    .status-popup .close-popup:hover { color: #fff; }

    #priceDisclaimerPopup {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.92);
      z-index: 99999;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    #priceDisclaimerPopup .popup-box {
      max-width: 720px;
      width: 100%;
      background: #111;
      border: 2px solid var(--primary-solid);
      border-radius: 14px;
      padding: 22px;
      text-align: center;
      box-shadow: 0 0 40px rgba(255,0,0,0.18);
    }
    #priceDisclaimerPopup h2 {
      margin: 0 0 12px 0;
      color: var(--primary-solid);
      text-transform: uppercase;
      letter-spacing: 1px;
      font-size: 18px;
    }
    #priceDisclaimerPopup p {
      margin: 0;
      font-size: 15px;
      line-height: 1.6;
      color: #eee;
    }
    #priceDisclaimerPopup button {
      margin-top: 18px;
      background: var(--primary-solid);
      border: none;
      padding: 12px 22px;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      color: #fff;
      text-transform: uppercase;
    }

    .map-wrap { border: 1px solid #222; border-radius: 12px; overflow: hidden; }
    .map-wrap iframe { width: 100%; height: 420px; border: 0; display: block; }
    @media (max-width: 600px) {
      .map-wrap iframe { height: 320px; }
    }

    #contactPopup {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.92);
      z-index: 999999;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    #contactPopup .popup-box {
      max-width: 720px;
      width: 100%;
      background: #111;
      border: 2px solid var(--primary-solid);
      border-radius: 14px;
      padding: 22px;
      text-align: center;
      box-shadow: 0 0 40px rgba(255,0,0,0.18);
      position: relative;
    }
    #contactPopup h2 {
      margin: 0 0 12px 0;
      color: var(--primary-solid);
      text-transform: uppercase;
      letter-spacing: 1px;
      font-size: 18px;
    }
    #contactPopup p {
      margin: 8px 0;
      font-size: 15px;
      line-height: 1.6;
      color: #eee;
    }
    #contactPopup a {
      color: #25D366;
      font-weight: 800;
      text-decoration: underline;
    }
    #contactPopup .close-popup {
      position: absolute;
      top: 10px;
      right: 14px;
      cursor: pointer;
      color: #aaa;
      font-size: 22px;
    }
    #contactPopup .close-popup:hover { color: #fff; }
  </style>
</head>

<body>

<header>
  <div class="nav">
    <a href="#" class="logo">
      <div class="logo-mark">CG</div>
      Car<span>Groomers</span>
    </a>
    <nav>
      <a href="#services">Services</a>
      <a href="#plans">Plans</a>
      <a href="#gallery">Gallery</a>
      <a href="#working">Working</a>
      <a href="#testimonials">Reviews</a>
      <a onclick="openModal('contactPopup')">Contact</a>
      <a class="book-btn" onclick="openBooking('Full Detailing')">Book Now</a>
    </nav>
  </div>
</header>

<section class="hero">
  <div class="hero-slides">
    <div class="slide active" style="background-image: url('https://images.unsplash.com/photo-1618843479313-40f8afb4b4d8?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80');"></div>
    <div class="slide" style="background-image: url('https://images.unsplash.com/photo-1542282088-fe8426682b8f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80');"></div>
    <div class="slide" style="background-image: url('https://images.unsplash.com/photo-1519641471654-76ce0107ad1b?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80');"></div>
  </div>
  <div class="hero-overlay"></div>
  <div class="hero-content">
    <h1>Unleash Your Car's <span style="color: var(--primary-solid); display:block; font-size: 0.6em; margin-top: 10px;">True Potential</span></h1>
    <p>Precision Detailing & Protection in the Studio and on the Road</p>
    <button class="book-btn" onclick="openBooking('')">Book Now</button>
  </div>
</section>

<section id="services">
  <div class="container">
    <div class="section-title">
      <h2>Our Core Services</h2>
      <p>Precision execution for premium vehicles</p>
    </div>

    <div class="services-grid">
      <div class="service-card" onclick="openBooking('PPF')">
        <div class="media">
          <img src="ppf.jpg" alt="PPF Application">
          <img src="ppf2.jpg" alt="PPF Close up">
        </div>
        <div class="content">
          <h3>Paint Protection Film</h3>
          <p>The ultimate shield against rock chips, road debris, and scratches.</p>
        </div>
      </div>

      <div class="service-card" onclick="openBooking('Ceramic Coating')">
        <div class="media">
          <img src="ceramic%20coating.webp" alt="Ceramic Coating">
          <img src="ceramic%20coating2.jpg" alt="Ceramic Coating Finish">
        </div>
        <div class="content">
          <h3>Ceramic Coating</h3>
          <p>Advanced hydrophobic layer providing deep gloss and chemical resistance.</p>
        </div>
      </div>

      <div class="service-card" onclick="openBooking('Window Tint')">
        <div class="media">
          <img src="window%20tint.webp" alt="Window Tint">
          <img src="window%20tint2.jpg" alt="Window Tint Finish">
        </div>
        <div class="content">
          <h3>Window Tinting</h3>
          <p>Nanoceramic film for superior heat rejection and interior privacy.</p>
        </div>
      </div>

      <div class="service-card" onclick="openBooking('Full Detailing')">
        <div class="media">
          <img src="car ddetailing.jpg" alt="Car Detailing - Pressure Wash">
          <img src="car detailing2.jpg" alt="Car Detailing - Interior Cleaning">
        </div>
        <div class="content">
          <h3>Car Detailing</h3>
          <p>Meticulous deep-clean restoration for a factory-new finish.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<section id="plans">
  <div class="container">
    <div class="section-title">
      <h2>Protection Plans</h2>
      <p>Save up to 10% when you combine services</p>
    </div>

    <div class="plans-flex-container">
      <div class="plan">
        <h3>Window Tint</h3>
        <div class="price">$199+</div>
        <ul>
          <li>Full Side & Rear</li>
          <li>IR Heat Rejection</li>
          <li>Lifetime Warranty</li>
        </ul>
        <button onclick="showPriceDisclaimer(); openBooking('Window Tint')">Select</button>
      </div>

      <div class="plan">
        <h3>PPF Shield</h3>
        <div class="price">$899+</div>
        <ul>
          <li>Front Bumper & Hood</li>
          <li>Self-Healing Tech</li>
          <li>10 Year Warranty</li>
        </ul>
        <button onclick="showPriceDisclaimer(); openBooking('PPF')">Select</button>
      </div>

      <div class="plan">
        <h3>Ceramic Pro</h3>
        <div class="price">$599+</div>
        <ul>
          <li>4-Stage Prep Wash</li>
          <li>9H Surface Coating</li>
          <li>Mirror-Like Shine</li>
        </ul>
        <button onclick="showPriceDisclaimer(); openBooking('Ceramic Coating')">Select</button>
      </div>

      <div class="plan">
        <h3>Pro Detail</h3>
        <div class="price">$650+</div>
        <ul>
          <li>Leather/Fabric Care</li>
          <li>Paint Decontamination</li>
          <li>Engine Bay Clean</li>
        </ul>
        <button onclick="showPriceDisclaimer(); openBooking('Full Detailing')">Select</button>
      </div>

      <div class="plan custom-plan">
        <h3>Custom Combo</h3>
        <div class="price">Save More</div>
        <ul>
          <li>Pick 2 ‚Üí 5% Off</li>
          <li>Pick 3+ ‚Üí 10% Off</li>
          <li>Auto Discount Total</li>
        </ul>
        <button onclick="showPriceDisclaimer(); openModal('comboModal')">Build Plan</button>
      </div>
    </div>

    <div class="price-warning-box">
      <h3>‚ö†Ô∏è Important Pricing Note</h3>
      <p style="margin-top:5px; font-size:13px; color:#ffecb3;">
        The prices listed above are <strong>starting estimates</strong> based on compact vehicles in average condition.
        <br>
        Final cost will vary depending on your vehicle's <strong>Size (SUV/Truck)</strong>, <strong>Paint Condition</strong>, and <strong>Specific Requirements</strong>.
        <br>
        We inspect every vehicle before starting work to ensure accuracy.
      </p>
    </div>
  </div>
</section>

<section id="gallery">
  <div class="container">
    <div class="section-title">
      <h2>Recent Works</h2>
      <p>From the studio to the open road.</p>
    </div>
    <div class="gallery">
      <div class="gallery-item" onclick="openBooking('Exterior Wash')">
        <img src="https://images.unsplash.com/photo-1552519507-da3b142c6e3d?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Studio Detail">
        <div class="gallery-label">Studio Detail</div>
      </div>

      <div class="gallery-item" onclick="openBooking('PPF')">
        <img src="https://images.unsplash.com/photo-1533473359331-0135ef1b58bf?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="PPF Work">
        <div class="gallery-label">Outdoor Protection</div>
      </div>

      <div class="gallery-item" onclick="openBooking('Ceramic Coating')">
        <img src="https://images.unsplash.com/photo-1503376763036-066120622c74?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Ceramic Finish">
        <div class="gallery-label">Road Performance</div>
      </div>

      <div class="gallery-item" onclick="openBooking('Interior Cleaning')">
        <img src="https://images.unsplash.com/photo-1493238792015-1a419af69290?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80" alt="Interior Cleaning">
        <div class="gallery-label">Interior Precision</div>
      </div>
    </div>
  </div>
</section>

<section id="working">
  <div class="container">
    <div class="section-title">
      <h2>Working Photos</h2>
      <p>Real behind-the-scenes work at CarGroomers.</p>
    </div>

    <div class="working-grid">
      <div class="working-card">
        <img src="ppf.jpg" alt="Working - PPF">
        <div class="w-content">
          <h4>PPF Installation</h4>
          <p>Precision fitment for front-end protection and self-healing coverage.</p>
        </div>
      </div>

      <div class="working-card">
        <img src="ceramic%20coating.webp" alt="Working - Ceramic">
        <div class="w-content">
          <h4>Ceramic Coating</h4>
          <p>Deep gloss finish with hydrophobic protection and easy maintenance.</p>
        </div>
      </div>

      <div class="working-card">
        <img src="window%20tint.webp" alt="Working - Tint">
        <div class="w-content">
          <h4>Window Tinting</h4>
          <p>Heat rejection and privacy with premium nanoceramic tint options.</p>
        </div>
      </div>

      <div class="working-card">
        <img src="car detailing2.jpg" alt="Working - Detailing">
        <div class="w-content">
          <h4>Interior Detailing</h4>
          <p>Deep clean upholstery, plastics, and premium interior restoration.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<section id="testimonials">
  <div class="container">
    <div class="section-title">
      <h2>Google Reviews</h2>
      <p>Verified customer feedback from Google.</p>
    </div>

    <div class="map-wrap">
      <iframe
        src="https://www.google.com/maps?q=132%20Rue%20Montalet%2C%20Beaumont&output=embed"
        loading="lazy"
        referrerpolicy="no-referrer-when-downgrade"
        allowfullscreen=""
        title="CarGroomers Location Map">
      </iframe>
    </div>

    <p style="text-align:center; margin-top:15px; color:#aaa; font-size:13px;">
      <a href="https://www.google.com/maps/search/?api=1&query=132+Rue+Montalet,+Beaumont" target="_blank" style="color:#25D366; font-weight:700;">
        ‚≠ê See Google Reviews
      </a>
    </p>

    <p style="text-align:center; margin-top:15px; color:#aaa; font-size:13px;">
      Tip: Google Maps ‚Üí Share ‚Üí Embed a map ‚Üí Copy iframe link here.
    </p>
  </div>
</section>

<section id="faq">
  <div class="container faq">
    <div class="section-title">
      <h2>Frequently Asked Questions</h2>
      <p>Everything you need to know before booking</p>
    </div>

    <div class="faq-item">
      <h3>How long does the service take?</h3>
      <p>It depends on the service! A standard detail takes about 3-5 hours. However, Ceramic Coatings and PPF applications usually require 1 to 3 days to ensure proper prep, application, and curing time.</p>
    </div>

    <div class="faq-item">
      <h3>Do I need to leave my car with you?</h3>
      <p>Yes. Because we are a professional studio controlling lighting and temperature, we need the vehicle dropped off. We do offer a key-drop service for early mornings.</p>
    </div>

    <div class="faq-item">
      <h3>Can you remove deep scratches?</h3>
      <p>We can significantly improve paint defects with our paint correction (polishing) service. However, if your fingernail catches deep in the scratch, it may require body shop work. We can assess this for free in person.</p>
    </div>

    <div class="faq-item">
      <h3>What is the difference between PPF and Ceramic Coating?</h3>
      <p>Think of PPF as a "screen protector" for your car‚Äîit stops rock chips and physical damage. Ceramic Coating is like a "hard wax on steroids"‚Äîit provides incredible gloss and makes cleaning easy, but it won't stop a rock chip. We often recommend doing both.</p>
    </div>
  </div>
</section>

<footer id="contact">
  <div class="footer-grid">
    <div>
      <a href="#" class="logo">
        <div class="logo-mark">CG</div>
        Car<span>Groomers</span>
      </a>
      <p style="margin-top: 20px;">Beaumont's premier auto styling and protection studio.</p>
    </div>
    <div class="footer-info">
      <h3>Contact Info</h3>
      <p>üìß cargroomers1@gmail.com</p>
      <p>üìç 132 Rue Montalet, Beaumont</p>
      <p>üìû +1 (780) 655-3757</p>
      <p>üìû +1 (780) 818-0211</p>
    </div>
  </div>
  <div style="text-align: center; margin-top: 50px; padding-top: 20px; border-top: 1px solid #222;">
    <p>&copy; 2025 CarGroomers Auto Studio.</p>
  </div>
</footer>

<div class="back-to-top" id="backToTopBtn" onclick="scrollToTop()">‚Üë</div>

<a href="https://wa.me/17806553757" target="_blank" class="whatsapp-float-btn" title="Chat on WhatsApp">
  <svg width="32" height="32" viewBox="0 0 24 24" fill="white" xmlns="http://www.w3.org/2000/svg">
    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
  </svg>
</a>

<div class="chatbot-btn" onclick="toggleChat()">
  <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
  </svg>
</div>

<div class="chatbot-window" id="chatWindow">
  <div class="chatbot-header">
    <div class="bot-identity">
      <div class="bot-avatar">CG</div>
      <div>
        <div style="font-size:16px;">CG Assistant</div>
        <div style="font-size:10px; opacity:0.8;">Virtual Assistant</div>
      </div>
    </div>
    <div>
      <span style="font-size: 20px; cursor: pointer; color: #ccc;" onclick="toggleChat()">&times;</span>
    </div>
  </div>

  <div class="chatbot-messages" id="chatMessages">
    <div class="msg bot">
      Hello! I'm <b>CG Assistant</b>. I can help with prices, services, and booking. What can I do for you today?
    </div>
  </div>

  <div class="typing" id="typingIndicator">CG Assistant is typing...</div>

  <div class="chatbot-input">
    <input type="text" id="chatInput" placeholder="Ask about price, PPF, tint..." onkeydown="handleChatEnter(event)" autocomplete="off">
    <button onclick="processUserMessage()">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="22" y1="2" x2="11" y2="13"></line>
        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
      </svg>
    </button>
  </div>
</div>

<!-- ‚úÖ BOOKING MODAL -->
<div id="bookingModal" class="modal">
  <div class="modal-box">
    <span class="close" onclick="closeModal('bookingModal')">&times;</span>
    <h2 style="color: var(--primary-solid); margin-bottom: 20px; text-transform: uppercase;">Book Your Service</h2>

    <form id="bookingForm">
      <label>Name</label>
      <input type="text" id="bookName" placeholder="Name" required>

      <label>Phone Number</label>
      <input type="tel" id="bookPhone" placeholder="10 digit phone number" required>

      <!-- ‚úÖ REQUIRED CHANGE ONLY: ADD missing services -->
      <label>Service Interest (Select Multiple)</label>
      <div id="serviceCheckboxes" style="display:flex; flex-direction:column; gap:10px; margin-bottom:20px;">
        <label style="text-transform:none; font-weight:500; color:#fff;">
          <input type="checkbox" value="PPF"> PPF
        </label>
        <label style="text-transform:none; font-weight:500; color:#fff;">
          <input type="checkbox" value="Ceramic Coating"> Ceramic Coating
        </label>
        <label style="text-transform:none; font-weight:500; color:#fff;">
          <input type="checkbox" value="Window Tint"> Window Tint
        </label>
        <label style="text-transform:none; font-weight:500; color:#fff;">
          <input type="checkbox" value="Full Detailing"> Full Detailing
        </label>
        <label style="text-transform:none; font-weight:500; color:#fff;">
          <input type="checkbox" value="Interior Cleaning"> Interior Cleaning
        </label>
        <label style="text-transform:none; font-weight:500; color:#fff;">
          <input type="checkbox" value="Exterior Wash"> Exterior Wash
        </label>
      </div>

      <label>Vehicle Make/Model</label>
      <input type="text" id="bookVehicle" placeholder="e.g. 2023 BMW X5">

      <label>Preferred Date</label>
      <input type="date" id="preferredDate" required>

      <label>Preferred Time</label>
      <select id="preferredTime" required>
        <option value="">Select Preferred Time</option>
        <option>10:00 AM - 12:00 PM</option>
        <option>12:00 PM - 02:00 PM</option>
        <option>02:00 PM - 04:00 PM</option>
        <option>04:00 PM - 06:00 PM</option>
      </select>

      <button type="submit" class="submit-btn">Send Request</button>
    </form>
  </div>
</div>

<!-- ‚úÖ COMBO MODAL -->
<div id="comboModal" class="modal">
  <div class="modal-box">
    <span class="close" onclick="closeModal('comboModal')">&times;</span>
    <h2 style="margin-bottom: 10px; color: var(--primary-solid); text-transform: uppercase;">Build Custom Plan</h2>
    <p style="margin-bottom: 20px; font-size: 14px; color: #aaa;">
      Select 2+ items for discount:
      <br><b>2 items = 5% Off</b> | <b>3+ items = 10% Off</b>
    </p>

    <div class="combo-option" onclick="toggleCombo(this, 'Window Tint', 199)">
      <span>Window Tint</span>
      <span>$199</span>
    </div>
    <div class="combo-option" onclick="toggleCombo(this, 'PPF', 899)">
      <span>Front PPF</span>
      <span>$899</span>
    </div>
    <div class="combo-option" onclick="toggleCombo(this, 'Ceramic Coating', 599)">
      <span>Ceramic Coating</span>
      <span>$599</span>
    </div>
    <div class="combo-option" onclick="toggleCombo(this, 'Full Detailing', 650)">
      <span>Full Detailing</span>
      <span>$650</span>
    </div>

    <div class="price-summary">
      <div style="display:flex; justify-content:space-between; margin-bottom: 5px;">
        <span>Subtotal:</span>
        <span id="comboSubtotal">$0</span>
      </div>
      <div style="display:flex; justify-content:space-between; margin-bottom: 5px; color: #10b981;">
        <span>Discount:</span>
        <span id="comboDiscount">-$0</span>
      </div>
      <div style="display:flex; justify-content:space-between; font-weight: 700; font-size: 18px; margin-top: 10px; color: #fff;">
        <span>Total:</span>
        <span id="comboTotal">$0</span>
      </div>
    </div>

    <button class="book-btn" style="width:100%; margin-top: 20px;" onclick="sendCustomComboRequest()">
      Send Request
    </button>
  </div>
</div>

<div id="statusPopup" class="status-popup">
  <span class="close-popup" onclick="hideStatusPopup()">&times;</span>
  <h4 id="statusTitle">Booking Update</h4>
  <p id="statusText"></p>
</div>

<div id="priceDisclaimerPopup">
  <div class="popup-box">
    <h2>Important Pricing Notice</h2>
    <p>
      Price may vary as per the <b>car condition</b>, <b>car model</b>, <b>car size</b>,
      and other factors. Final price will be confirmed after inspection.
    </p>
    <button onclick="closePriceDisclaimer()">OK, Got it</button>
  </div>
</div>

<div id="contactPopup">
  <div class="popup-box">
    <span class="close-popup" onclick="closeModal('contactPopup')">&times;</span>
    <h2>Contact Now</h2>
    <p>üìß <b>cargroomers1@gmail.com</b></p>
    <p>üìç <b>132 Rue Montalet, Beaumont</b></p>
    <p>üìû <b>+1 (780) 655-3757</b></p>
    <p>üìû <b>+1 (780) 818-0211</b></p>
    <p style="margin-top:14px;">
      ‚úÖ WhatsApp:
      <a href="https://wa.me/17806553757" target="_blank"><b>Chat on WhatsApp</b></a>
    </p>
  </div>
</div>

<script>
  // ‚úÖ Render backend base URL for ALL API calls
  const API_BASE = "https://cargroomers.onrender.com";

  // --- SLIDESHOW ---
  let currentSlide = 0;
  const slides = document.querySelectorAll('.slide');
  function nextSlide() {
    slides[currentSlide].classList.remove('active');
    currentSlide = (currentSlide + 1) % slides.length;
    slides[currentSlide].classList.add('active');
  }
  setInterval(nextSlide, 5000);

  // --- MODALS ---
  function openModal(id) {
    document.getElementById(id).style.display = 'flex';
  }
  function closeModal(id) {
    document.getElementById(id).style.display = 'none';
  }

  // ‚úÖ FIX: openBooking selects checkbox (works for ALL services now)
  function openBooking(serviceName) {
    document.querySelectorAll("#serviceCheckboxes input[type='checkbox']").forEach(cb => {
      cb.checked = false;
    });

    if (serviceName) {
      const match = Array.from(document.querySelectorAll("#serviceCheckboxes input[type='checkbox']"))
        .find(cb => cb.value === serviceName);
      if (match) match.checked = true;
    }

    openModal('bookingModal');
  }

  function showPriceDisclaimer() {
    const popup = document.getElementById("priceDisclaimerPopup");
    if (popup) popup.style.display = "flex";
  }
  function closePriceDisclaimer() {
    const popup = document.getElementById("priceDisclaimerPopup");
    if (popup) popup.style.display = "none";
  }

  window.onclick = function(event) {
    if (event.target.classList.contains('modal')) {
      event.target.style.display = "none";
    }
    if (event.target.id === "contactPopup") {
      event.target.style.display = "none";
    }
  }

  // ‚úÖ CUSTOM COMBO CALCULATOR
  let comboSubtotal = 0;
  let comboSelectedServices = [];

  function toggleCombo(element, serviceName, price) {
    element.classList.toggle('selected');
    const isSelected = element.classList.contains('selected');

    if (isSelected) {
      comboSubtotal += price;
      if (!comboSelectedServices.includes(serviceName)) comboSelectedServices.push(serviceName);
    } else {
      comboSubtotal -= price;
      comboSelectedServices = comboSelectedServices.filter(s => s !== serviceName);
    }

    updateComboDisplay();
  }

  function updateComboDisplay() {
    const subtotalEl = document.getElementById('comboSubtotal');
    const discountEl = document.getElementById('comboDiscount');
    const totalEl = document.getElementById('comboTotal');

    const selectedCount = comboSelectedServices.length;

    let discountPercent = 0;
    if (selectedCount === 2) discountPercent = 0.05;
    else if (selectedCount > 2) discountPercent = 0.10;

    const discountValue = comboSubtotal * discountPercent;
    const finalTotal = comboSubtotal - discountValue;

    subtotalEl.innerText = '$' + Math.ceil(comboSubtotal);
    discountEl.innerText = '-$' + Math.floor(discountValue);
    totalEl.innerText = '$' + Math.ceil(finalTotal);
  }

  function sendCustomComboRequest() {
    if (comboSelectedServices.length < 2) {
      alert("‚ö†Ô∏è Please select at least 2 services to build a custom combo plan.");
      return;
    }

    closeModal("comboModal");
    openModal("bookingModal");

    // ‚úÖ Auto-check services in booking form
    document.querySelectorAll("#serviceCheckboxes input[type='checkbox']").forEach(cb => {
      cb.checked = comboSelectedServices.includes(cb.value);
    });
  }

  // --- FAQ TOGGLE ---
  document.querySelectorAll('.faq-item h3').forEach(item => {
    item.addEventListener('click', () => {
      const p = item.nextElementSibling;
      p.style.display = p.style.display === 'block' ? 'none' : 'block';
    });
  });

  // --- BACK TO TOP ---
  function scrollToTop() {
    window.scrollTo({top: 0, behavior: 'smooth'});
  }
  window.addEventListener('scroll', () => {
    const btn = document.getElementById('backToTopBtn');
    if(window.scrollY > 300) btn.classList.add('show');
    else btn.classList.remove('show');
  });

  // --- CHATBOT ---
  const CONTACT_EMAIL = "cargroomers1@gmail.com";
  const CONTACT_ADDRESS = "132 Rue Montalet, Beaumont";
  const CONTACT_PHONE_1 = "+1 (780) 655-3757";
  const CONTACT_PHONE_2 = "+1 (780) 818-0211";

  function toggleChat() {
    const win = document.getElementById('chatWindow');
    win.style.display = (win.style.display === 'flex') ? 'none' : 'flex';
  }

  function handleChatEnter(e) {
    if (e.key === 'Enter') processUserMessage();
  }

  function addMessage(text, sender, isHtml = false) {
    const div = document.createElement('div');
    div.className = `msg ${sender}`;
    if (isHtml) div.innerHTML = text;
    else div.innerText = text;

    const container = document.getElementById('chatMessages');
    container.appendChild(div);
    container.scrollTop = container.scrollHeight;
  }

  async function replyWithNewSlots() {
    const requestId = localStorage.getItem("cg_request_id");

    if (!requestId) {
      addMessage(
        "I can't find your booking request. Please book first using <b>Book Now</b> ‚úÖ",
        "bot",
        true
      );
      return;
    }

    try {
      const res = await fetch(`${API_BASE}/api/booking/${requestId}`);
      const data = await res.json();

      if (!data.booking) {
        addMessage("No booking found for your request ID.", "bot");
        return;
      }

      const booking = data.booking;
      const status = (booking.status || "").toLowerCase();

      const suggestedDate = booking.suggested_date || booking.suggestedDate || "";
      const suggestedTime = booking.suggested_time || booking.suggestedTime || "";

      const confirmedDate = booking.confirmed_date || booking.confirmedDate || booking.date || "";
      const confirmedTime = booking.confirmed_time || booking.confirmedTime || booking.time || "";

      if (status === "pending") {
        addMessage(
          `‚è≥ Your booking is still <b>PENDING</b>.<br><br>
           Please wait for confirmation from our team.`,
          "bot",
          true
        );
        return;
      }

      if (status === "accepted") {
        addMessage(
          `‚úÖ Your booking is <b>ACCEPTED</b>.<br><br>
           üìÖ <b>${new Date(confirmedDate).toISOString().slice(0,10)}</b><br>
           ‚è∞ <b>${confirmedTime}</b>`,
          "bot",
          true
        );
        return;
      }

      if (status === "rejected") {
        if (suggestedDate && suggestedTime) {
          addMessage(
            `‚ùå Your booking is <b>REJECTED</b>.<br><br>
             ‚úÖ But our team suggested a new slot:<br>
             üìÖ <b>${new Date(suggestedDate).toISOString().slice(0,10)}</b><br>
             ‚è∞ <b>${suggestedTime}</b><br><br>
             Please contact us to confirm this new slot.`,
            "bot",
            true
          );
          return;
        }

        addMessage(
          `‚ùå Your booking is <b>REJECTED</b>.<br><br>
           Please contact us to book a new slot.`,
          "bot",
          true
        );
        return;
      }

      addMessage("Booking status not available right now. Please contact our team.", "bot");
    } catch (err) {
      addMessage("Server error while checking your booking status.", "bot");
    }
  }

  function processUserMessage() {
    const input = document.getElementById('chatInput');
    const msg = input.value.trim();
    if (!msg) return;

    addMessage(msg, 'user');
    input.value = '';

    const typingInfo = document.getElementById('typingIndicator');
    typingInfo.style.display = 'block';

    setTimeout(async () => {
      typingInfo.style.display = 'none';

      const lowerMsg = msg.toLowerCase();
      let replyHtml = "";

      if (
        lowerMsg.includes("status") ||
        lowerMsg.includes("accepted") ||
        lowerMsg.includes("rejected") ||
        lowerMsg.includes("pending") ||
        lowerMsg.includes("new slot") ||
        lowerMsg.includes("new slots") ||
        lowerMsg.includes("slot") ||
        lowerMsg.includes("timing") ||
        lowerMsg.includes("time") ||
        lowerMsg.includes("date")
      ) {
        await replyWithNewSlots();
        return;
      }

      if (lowerMsg.includes('price') || lowerMsg.includes('cost')) {
        replyHtml = "Our prices start at <b>$199</b> for tint and <b>$250</b> for detailing. PPF starts at <b>$899</b>.";
      }
      else if (lowerMsg.includes('ppf')) {
        replyHtml = "PPF (Paint Protection Film) is a clear shield for your paint. We use self-healing technology. Packages start at <b>$899</b>.";
      }
      else if (lowerMsg.includes('tint')) {
        replyHtml = "We offer Carbon and Ceramic tint. Full car packages start at <b>$199</b>.";
      }
      else if (lowerMsg.includes('book') || lowerMsg.includes('appointment')) {
        replyHtml = "You can book directly by clicking the <b>Book Now</b> button ‚úÖ";
      }
      else if (lowerMsg.includes('location') || lowerMsg.includes('where') || lowerMsg.includes('address')) {
        replyHtml = "üìç We are located at <b>" + CONTACT_ADDRESS + "</b>.";
      }
      else {
        replyHtml =
          "I‚Äôm not sure about that. Please contact our team for help üëá<br><br>" +
          "üìß <b>" + CONTACT_EMAIL + "</b><br>" +
          "üìç <b>" + CONTACT_ADDRESS + "</b><br>" +
          "üìû <b>" + CONTACT_PHONE_1 + "</b><br>" +
          "üìû <b>" + CONTACT_PHONE_2 + "</b><br><br>" +
          "‚úÖ WhatsApp: <a href='https://wa.me/17806553757' target='_blank'><b>Chat on WhatsApp</b></a><br>" +
          "‚≠ê Google Reviews: <a href='https://www.google.com/maps/search/?api=1&query=132+Rue+Montalet,+Beaumont' target='_blank'><b>See Google Reviews</b></a>";
      }

      addMessage(replyHtml, 'bot', true);
    }, 800);
  }

  // ‚úÖ REQUIRED CHANGE: date picker limits (MOVED OUTSIDE submit handler)
  function setDateLimits() {
    const dateInput = document.getElementById("preferredDate");
    if (!dateInput) return;

    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth() + 1).padStart(2, "0");
    const dd = String(today.getDate()).padStart(2, "0");
    const minDate = `${yyyy}-${mm}-${dd}`;

    const oneYearLater = new Date(today);
    oneYearLater.setFullYear(oneYearLater.getFullYear() + 1);
    const yyyy2 = oneYearLater.getFullYear();
    const mm2 = String(oneYearLater.getMonth() + 1).padStart(2, "0");
    const dd2 = String(oneYearLater.getDate()).padStart(2, "0");
    const maxDate = `${yyyy2}-${mm2}-${dd2}`;

    dateInput.min = minDate;
    dateInput.max = maxDate;
  }
  setDateLimits();

  /* ‚úÖ BOOKING FORM -> MULTI SERVICE + CLEAN PHONE + DATE LIMITS */
  document.getElementById("bookingForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const name = document.getElementById("bookName").value.trim();

    // ‚úÖ CLEAN PHONE (remove spaces, +, -, (), etc.)
    const rawPhone = document.getElementById("bookPhone").value.trim();
    const phone = rawPhone.replace(/[^\d]/g, ""); // keep only digits

    const vehicle = document.getElementById("bookVehicle").value.trim();
    const preferredDate = document.getElementById("preferredDate").value;
    const preferredTime = document.getElementById("preferredTime").value;

    // ‚úÖ Phone must be exactly 10 digits after cleaning
    if (!/^[0-9]{10}$/.test(phone)) {
      alert("‚ùå Phone number must be exactly 10 digits. (Spaces / - / () allowed)");
      return;
    }

    // ‚úÖ Date must be from today -> next 1 year only
    const today = new Date();
    today.setHours(0, 0, 0, 0);

    const bookingDate = new Date(preferredDate + "T00:00:00");
    if (isNaN(bookingDate.getTime())) {
      alert("‚ùå Please select a valid date.");
      return;
    }

    const oneYearLater = new Date(today);
    oneYearLater.setFullYear(oneYearLater.getFullYear() + 1);

    if (bookingDate < today) {
      alert("‚ùå Past dates are not allowed.");
      return;
    }

    if (bookingDate > oneYearLater) {
      alert("‚ùå Date must be within 1 year from today.");
      return;
    }

    // ‚úÖ selected services (checkboxes)
    const selectedServices = Array.from(
      document.querySelectorAll("#serviceCheckboxes input[type='checkbox']:checked")
    ).map(cb => cb.value.trim());

    if (selectedServices.length === 0) {
      alert("‚ùå Please select at least 1 service.");
      return;
    }

    const allowedServices = [
      "PPF",
      "Ceramic Coating",
      "Window Tint",
      "Full Detailing",
      "Interior Cleaning",
      "Exterior Wash"
    ];

    const invalid = selectedServices.find(s => !allowedServices.includes(s));
    if (invalid) {
      alert("‚ùå Invalid service selected: " + invalid);
      return;
    }

    // ‚úÖ note
    let note = vehicle ? `Vehicle: ${vehicle}` : "";

    // ‚úÖ Attach combo summary if user used combo builder
    if (comboSelectedServices.length >= 2 && comboSubtotal > 0) {
      const comboTotalText = document.getElementById("comboTotal")?.innerText || "$0";
      note = (note ? note + " | " : "") + `Combo Services: ${comboSelectedServices.join(", ")} | Combo Subtotal: $${Math.ceil(comboSubtotal)}, Combo Total: ${comboTotalText}`;
    }

    try {
      const res = await fetch(`${API_BASE}/api/book`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          name,
          phone,
          service: selectedServices, // ‚úÖ ARRAY
          date: preferredDate,
          time: preferredTime,
          note
        })
      });

      const data = await res.json();

      if (!res.ok || !data.success) {
        alert("‚ùå Error: " + (data.error || "Booking failed"));
        return;
      }

      if (data.bookingId) {
        localStorage.setItem("cg_request_id", data.bookingId);
        localStorage.removeItem("cg_last_popup_signature");
      }

      alert("‚úÖ Booking Request Sent!\nBooking ID: " + (data.bookingId || ""));

      closeModal("bookingModal");
      document.getElementById("bookingForm").reset();

      // ‚úÖ Reset combo data after successful booking
      comboSubtotal = 0;
      comboSelectedServices = [];
      document.querySelectorAll(".combo-option.selected").forEach(el => el.classList.remove("selected"));
      updateComboDisplay();

      // ‚úÖ reset date limits again (because reset clears value)
      setDateLimits();

    } catch (err) {
      alert("‚ùå Server Error. Please try again.");
    }
  });

  function showStatusPopup(title, text) {
    document.getElementById("statusTitle").innerText = title;
    document.getElementById("statusText").innerHTML = text;
    const popup = document.getElementById("statusPopup");
    popup.style.display = "block";
  }

  function hideStatusPopup() {
    document.getElementById("statusPopup").style.display = "none";
  }

  function getSuggestedSlot(booking) {
    return {
      date: booking.suggested_date || booking.suggestedDate || "",
      time: booking.suggested_time || booking.suggestedTime || ""
    };
  }

  function makePopupSignature(booking) {
    const suggested = getSuggestedSlot(booking);

    return JSON.stringify({
      id: booking.id,
      status: booking.status,
      confirmed_date: booking.confirmed_date || booking.confirmedDate || "",
      confirmed_time: booking.confirmed_time || booking.confirmedTime || "",
      suggested_date: suggested.date,
      suggested_time: suggested.time
    });
  }

  async function checkBookingStatus() {
    const requestId = localStorage.getItem("cg_request_id");
    if (!requestId) return;

    try {
      const res = await fetch(`${API_BASE}/api/booking/${requestId}`);
      const data = await res.json();
      if (!data.booking) return;

      const booking = data.booking;

      if (booking.status === "pending") return;

      const newSignature = makePopupSignature(booking);
      const oldSignature = localStorage.getItem("cg_last_popup_signature");

      if (oldSignature === newSignature) return;
      localStorage.setItem("cg_last_popup_signature", newSignature);

      if (booking.status === "accepted") {
        const dateToShow = booking.confirmed_date || booking.confirmedDate || booking.date;
        const timeToShow = booking.confirmed_time || booking.confirmedTime || booking.time;

        showStatusPopup(
          "‚úÖ Booking Accepted",
          `Your booking is confirmed for <b>${new Date(dateToShow).toISOString().slice(0,10)}</b> at <b>${timeToShow}</b>.`
        );
        return;
      }

      if (booking.status === "rejected") {
        const suggested = getSuggestedSlot(booking);

        if (suggested.date && suggested.time) {
          showStatusPopup(
            "‚ùå Booking Rejected",
            `Your request is rejected.<br><br>
            ‚úÖ <b>But our team suggested new time & date:</b><br>
            üìÖ <b>${new Date(suggested.date).toISOString().slice(0,10)}</b><br>
            ‚è∞ <b>${suggested.time}</b><br><br>
            Please contact us to confirm this slot.`
          );
          return;
        }

        showStatusPopup(
          "‚ùå Booking Rejected",
          `Sorry, your booking request was rejected.<br><br>Please contact us for new slot booking.`
        );
        return;
      }

    } catch (err) {
      // ignore
    }
  }

  setInterval(checkBookingStatus, 6000);
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
